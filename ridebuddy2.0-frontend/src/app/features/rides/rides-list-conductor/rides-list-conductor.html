<div class="max-w-7xl mx-5 my-7">
  <!-- Card -->
  <div class="u-card-glass">

    <!-- Header -->
    <div class="bg-linear-to-r from-emerald-500/30 to-cyan-500/30 dark:from-emerald-500/20 dark:to-cyan-500/20 p-6 rounded-2xl mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-slate-100">My Rides</h2>
      <p class="text-slate-600 dark:text-slate-400 text-sm">Manage, filter, and track all your rides</p>
    </div>

    <!-- Filter Section -->
    <div class="p-6 border-b border-white/20 dark:border-white/10">
      <div class="flex flex-wrap items-center gap-3">

        <!-- Column Selection -->
        <select
          [(ngModel)]="filterColumn"
          class="px-4 py-2 bg-white/50 dark:bg-white/5 border-2 border-slate-200 dark:border-white/20 rounded-lg text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:focus:ring-emerald-500/30 transition"
        >
          <option value="">-- Choose Column --</option>
          <option value="departureLocation">Departure Location</option>
          <option value="destination">Destination</option>
          <option value="departureTime">Departure Time</option>
          <option value="availablePlaces">Available Places</option>
          <option value="pricePerSeat">Price per Seat</option>
          <option value="status">Status</option>
        </select>

        <!-- Filter text -->
        <input
          [(ngModel)]="filterValue"
          type="text"
          class="px-4 py-2 bg-white/50 dark:bg-white/5 border-2 border-slate-200 dark:border-white/20 rounded-lg text-sm text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:focus:ring-emerald-500/30 transition"
          placeholder="Filter value..."
        />

        <!-- Buttons -->
        <button
          class="px-4 py-2 bg-linear-to-r from-emerald-500 to-cyan-600 hover:from-emerald-600 hover:to-cyan-700 text-white rounded-lg text-sm font-semibold hover:shadow-lg hover:shadow-emerald-500/30 transition"
          (click)="applyFilter()"
        >
          Apply Filter
        </button>

        <button
          class="px-4 py-2 bg-slate-600 dark:bg-slate-700 hover:bg-slate-700 dark:hover:bg-slate-600 text-white rounded-lg text-sm font-semibold transition"
          (click)="resetFilter()"
        >
          Reset
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
        <tr class="bg-white/50 dark:bg-white/5 border-b border-white/20 dark:border-white/10">
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">#</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure Location</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Destination</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure Time</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Available Places</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Price</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Status</th>
          <th class="px-4 py-3 text-center font-semibold text-slate-900 dark:text-slate-100">Map</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Actions</th>
        </tr>
        </thead>

        <tbody>
          @for (ride of rides$ | async; track $index){
            <tr
              class="border-b border-white/10 dark:border-white/5 hover:bg-emerald-500/10 dark:hover:bg-emerald-500/10 transition duration-200 text-slate-900 dark:text-slate-100"
              [ngClass]="{
              'bg-emerald-100/50 dark:bg-emerald-500/20': ride.status === 'over',
              'bg-red-100/50 dark:bg-red-500/20': ride.status === 'canceled'
            }"
            >
              <td class="px-4 py-3">{{ $index + 1 }}</td>
              <td class="px-4 py-3">{{ ride.departureLocation }}</td>
              <td class="px-4 py-3">{{ ride.destination }}</td>
              <td class="px-4 py-3">
                {{ ride.departureDate }} {{ ride.departureTime }}
              </td>
              <td class="px-4 py-3">{{ ride.availablePlaces }}</td>
              <td class="px-4 py-3">{{ ride.pricePerSeat }} TND</td>

              <td class="px-4 py-3">
              <span
                class="px-2 py-1 rounded-full text-xs font-semibold"
                [ngClass]="{
                  'bg-emerald-200 dark:bg-emerald-500/30 text-emerald-800 dark:text-emerald-300': ride.status === 'over',
                  'bg-red-200 dark:bg-red-500/30 text-red-800 dark:text-red-300': ride.status === 'canceled',
                  'bg-yellow-200 dark:bg-yellow-500/30 text-yellow-800 dark:text-yellow-300': ride.status === 'in-progress' || !ride.status
                }"
              >
                {{ ride.status || 'in-progress' }}
              </span>
              </td>

              <td class="px-4 py-3 text-center">
                <a
                  [routerLink]="['/dashboard/rides/ride-visualize', ride.id]"
                  [state]="{ ride: ride }"
                  class="px-2 py-1 border-2 border-emerald-400 dark:border-emerald-400/30 bg-white/50 dark:bg-white/5 text-emerald-700 dark:text-emerald-300 rounded-lg hover:bg-emerald-500/20 dark:hover:bg-emerald-500/20 transition inline-block"
                >
                  <fa-icon [icon]="faMapLocation"></fa-icon>
                </a>
              </td>

              <td class="px-4 py-3 space-x-2">
                @if (ride.status !== 'over' && ride.status !== 'canceled') {
                  <button
                    class="px-3 py-1 bg-emerald-500 hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700 text-white rounded-lg text-xs font-semibold transition"
                    (click)="markAsOver(ride)"
                  >
                    Mark as Over
                  </button>
                }
                @if (ride.status !== 'over' && ride.status !== 'canceled') {
                  <button
                    class="px-3 py-1 bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-600 text-white rounded-lg text-xs font-semibold transition"
                    (click)="cancelRide(ride)"
                  >
                    Cancel
                  </button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 bg-white/50 dark:bg-white/5 border-t border-white/20 dark:border-white/10 text-center text-sm text-slate-600 dark:text-slate-400">
      Manage your rides efficiently with RideBuddy ðŸš—âœ¨
    </div>
  </div>
</div>
