<div class="max-w-7xl mx-5 my-7">
  <!-- Card -->
  <div class="bg-white rounded-2xl shadow-xl overflow-hidden">

    <!-- Header -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6">
      <h2 class="text-2xl font-bold text-white">Available Rides</h2>
      <p class="text-indigo-100 text-sm">Filter, reserve, and explore rides easily</p>
    </div>

    <!-- Filter Section -->
    <div class="p-6 border-b border-gray-200">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

        <!-- Column -->
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">Choose Column</label>
          <select
            [(ngModel)]="filterColumn"
            (change)="filterValue = ''"
            class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg text-sm
                   focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition"
          >
            <option value="">-- Select Column --</option>
            <option value="departureLocation">Departure Location</option>
            <option value="destination">Destination</option>
            <option value="departureTime">Departure Time</option>
            <option value="availablePlaces">Available Places</option>
            <option value="pricePerSeat">Price</option>
            <option value="status">Status</option>
            <option value="conductorName">Conductor</option>
          </select>
        </div>

        <!-- Value -->
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">Choose Value</label>
          <select
            [(ngModel)]="filterValue"
            class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg text-sm
                   focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-100 transition"
          >
            <option value="">-- Select Value --</option>
            <option *ngFor="let v of getDistinctValuesForColumn(filterColumn)" [value]="v">
              {{ v }}
            </option>
          </select>
        </div>

        <!-- Buttons -->
        <div class="flex items-end gap-3">
          <button
            class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg
                   text-sm font-semibold hover:shadow-lg transition"
            (click)="applyFilter()"
          >
            Apply
          </button>

          <button
            class="px-4 py-2 bg-gray-500 text-white rounded-lg text-sm font-semibold hover:bg-gray-600 transition"
            (click)="resetFilter()"
          >
            Reset
          </button>
        </div>

      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
        <tr class="bg-gray-100 border-b border-gray-200">
          <th class="px-4 py-3 text-left font-semibold text-gray-700">#</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Departure</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Destination</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Departure Time</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Available</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Price</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Status</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Comments</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Actions</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700">Details</th>
        </tr>
        </thead>

        <tbody>
        <tr
          *ngFor="let ride of rides$ | async; let i = index"
          class="border-b border-gray-100 hover:bg-gray-50 transition"
          [ngClass]="{ 'bg-yellow-50': ride.id === highlightRideId }"
        >
          <td class="px-4 py-3">{{ i + 1 }}</td>
          <td class="px-4 py-3">{{ ride.departureLocation }}</td>
          <td class="px-4 py-3">{{ ride.destination }}</td>
            <td class="px-4 py-3">{{ ride.departureDate }} {{ ride.departureTime }}</td>
          <td class="px-4 py-3">{{ ride.availablePlaces }}</td>
          <td class="px-4 py-3">{{ ride.pricePerSeat }} TND</td>

          <!-- Status Badge -->
          <td class="px-4 py-3">
              <span
                class="px-2 py-1 rounded-full text-xs font-semibold"
                [ngClass]="{
                  'bg-green-200 text-green-800': ride.status === 'over',
                  'bg-red-200 text-red-800': ride.status === 'canceled',
                  'bg-yellow-200 text-yellow-800': ride.status === 'in-progress'
                }"
              >
                {{ ride.status || 'in-progress' }}
              </span>
          </td>

          <td class="px-4 py-3">{{ ride.comments }}</td>

          <!-- Actions -->
          <td class="px-4 py-3">
            <!-- Already reserved -->
            <a
              *ngIf="userReservations.includes(ride.id)"
              [routerLink]="['/reservations/manage']"
              [queryParams]="{ rideId: ride.id }"
              class="inline-block px-3 py-1 bg-yellow-500 text-black rounded-lg text-xs font-semibold hover:bg-yellow-600 transition"
            >
              Manage
            </a>

            <!-- Reserve -->
            <div *ngIf="!userReservations.includes(ride.id)">
              <div *ngIf="ride.status === 'in-progress'" class="flex gap-2">

                <select #places class="border rounded px-2 py-1 text-sm">
                  <option
                    *ngFor="let _ of [].constructor(ride.availablePlaces); let idx = index"
                    [value]="idx + 1"
                  >
                    {{ idx + 1 }}
                  </option>
                </select>

                <button
                  class="px-3 py-1 bg-green-600 text-white rounded-lg text-xs font-semibold hover:bg-green-700 transition"
                  (click)="reserve(ride, +places.value)"
                >
                  Reserve
                </button>

              </div>
            </div>
          </td>

          <!-- Details -->
          <td class="px-4 py-3">
            <a
              [routerLink]="['/dashboard/rides/details', ride.id]"
              class="inline-block px-3 py-1 bg-indigo-600 text-white rounded-lg text-xs font-semibold hover:bg-indigo-700 transition"
            >
              View
            </a>
          </td>

        </tr>
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 bg-gray-50 border-t text-center text-sm text-gray-600">
      Explore and reserve rides effortlessly ðŸš—âœ¨
    </div>

  </div>
</div>
