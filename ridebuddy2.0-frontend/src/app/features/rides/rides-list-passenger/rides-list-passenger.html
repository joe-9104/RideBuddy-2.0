<div class="container my-4">
  <div class="filter-ui mb-3 p-3 border rounded">

    <div class="row g-2">
      <div class="col-md-4">
        <label>Choose Column:</label>
        <select [(ngModel)]="filterColumn" class="form-select"
                (change)="filterValue = ''">
          <option value="">-- Select Column --</option>
          <option value="departureLocation">Departure Location</option>
          <option value="destination">Destination</option>
          <option value="departureTime">Departure Time</option>
          <option value="availablePlaces">Available Places</option>
          <option value="pricePerSeat">Price</option>
          <option value="status">Status</option>
          <option value="conductorName">Conductor</option>
        </select>
      </div>

      <div class="col-md-4">
        <label>Choose Value:</label>
        <select [(ngModel)]="filterValue" class="form-select">
          <option value="">-- Select Value --</option>
          <option *ngFor="let v of getDistinctValuesForColumn(filterColumn)" [value]="v">
            {{ v }}
          </option>
        </select>
      </div>

      <div class="col-md-4 d-flex align-items-end gap-2">
        <button class="btn btn-primary" (click)="applyFilter()">Apply</button>
        <button class="btn btn-secondary" (click)="resetFilter()">Reset</button>
      </div>
    </div>
  </div>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Departure</th>
        <th>Destination</th>
        <th>Departure Time</th>
        <th>Available</th>
        <th>Price</th>
        <th>Status</th>
        <th>Conductor</th>
        <th>Comments</th>
        <th>Actions</th>
        <th>Details</th>
      </tr>
    </thead>

    <tbody>
    <tr *ngFor="let ride of rides$ | async; let i = index"
        [ngClass]="{
          'table-warning': ride.id === highlightRideId
        }">

      <td>{{ i + 1 }}</td>
      <td>{{ ride.departureLocation }}</td>
      <td>{{ ride.destination }}</td>
      <td>{{ ride.departureDate }} {{ ride.departureTime }}</td>
      <td>{{ ride.availablePlaces }}</td>
      <td>{{ ride.pricePerSeat }} TND</td>
      <td>{{ ride.status }}</td>
      <td>{{ ride.conductorName }}</td>
      <td>{{ ride.comments }}</td>

      <td>

        <!-- Already reserved -->
        <a *ngIf="userReservations.includes(ride.id)"
           [routerLink]="['/reservations/manage']"
           [queryParams]="{ rideId: ride.id }"
           class="btn btn-warning btn-sm text-nowrap">
          Manage Reservation
        </a>

        <!-- Not reserved -->
        <div *ngIf="!userReservations.includes(ride.id)">
          <div *ngIf="ride.status === 'in-progress'" class="d-flex gap-1">
            <select #places class="form-select form-select-sm w-auto">
              <option *ngFor="let n of [].constructor(ride.availablePlaces); let idx = index"
                      [value]="idx + 1">
                {{ idx + 1 }}
              </option>
            </select>
            <button class="btn btn-success btn-sm"
                    (click)="reserve(ride, +places.value)">
              Submit
            </button>
          </div>
        </div>
      </td>

      <td>
        <a [routerLink]="['/dashboard/rides/details', ride.id]"
           class="btn btn-secondary btn-sm">Details</a>
      </td>

    </tr>
    </tbody>
  </table>
</div>
