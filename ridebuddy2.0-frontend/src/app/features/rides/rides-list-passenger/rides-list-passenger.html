<div class="max-w-7xl mx-5 my-7">
  <!-- Card -->
  <div class="u-card-glass">

    <!-- Header -->
    <div class="bg-gradient-to-r from-emerald-500/30 to-cyan-500/30 dark:from-emerald-500/20 dark:to-cyan-500/20 p-6 rounded-2xl mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-slate-100">Available Rides</h2>
      <p class="text-slate-600 dark:text-slate-400 text-sm">Filter, reserve, and explore rides easily</p>
    </div>

    <!-- Filter Section -->
    <div class="p-6 border-b border-white/20 dark:border-white/10">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

        <!-- Column -->
        <div>
          <label class="block mb-1 text-sm font-medium text-slate-900 dark:text-slate-100">Choose Column</label>
          <select
            [(ngModel)]="filterColumn"
            (change)="filterValue = ''"
            class="w-full px-4 py-2 bg-white/50 dark:bg-white/5 border-2 border-slate-200 dark:border-white/20 rounded-lg text-sm text-slate-900 dark:text-slate-100
                   focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:focus:ring-emerald-500/30 transition"
          >
            <option value="">-- Select Column --</option>
            <option value="departureLocation">Departure Location</option>
            <option value="destination">Destination</option>
            <option value="departureTime">Departure Time</option>
            <option value="availablePlaces">Available Places</option>
            <option value="pricePerSeat">Price</option>
            <option value="status">Status</option>
            <option value="conductorName">Conductor</option>
          </select>
        </div>

        <!-- Value -->
        <div>
          <label class="block mb-1 text-sm font-medium text-slate-900 dark:text-slate-100">Choose Value</label>
          <select
            [(ngModel)]="filterValue"
            class="w-full px-4 py-2 bg-white/50 dark:bg-white/5 border-2 border-slate-200 dark:border-white/20 rounded-lg text-sm text-slate-900 dark:text-slate-100
                   focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:focus:ring-emerald-500/30 transition"
          >
            <option value="">-- Select Value --</option>
            <option *ngFor="let v of getDistinctValuesForColumn(filterColumn)" [value]="v">
              {{ v }}
            </option>
          </select>
        </div>

        <!-- Buttons -->
        <div class="flex items-end gap-3">
          <button
            class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-cyan-600 hover:from-emerald-600 hover:to-cyan-700 text-white rounded-lg text-sm font-semibold hover:shadow-lg hover:shadow-emerald-500/30 transition"
            (click)="applyFilter()"
          >
            Apply
          </button>

          <button
            class="px-4 py-2 bg-slate-600 dark:bg-slate-700 hover:bg-slate-700 dark:hover:bg-slate-600 text-white rounded-lg text-sm font-semibold transition"
            (click)="resetFilter()"
          >
            Reset
          </button>
        </div>

      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
        <tr class="bg-white/50 dark:bg-white/5 border-b border-white/20 dark:border-white/10">
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">#</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Destination</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure Time</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Available</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Price</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Status</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Comments</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Actions</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Details</th>
        </tr>
        </thead>

        <tbody>
        <tr
          *ngFor="let ride of rides$ | async; let i = index"
          class="border-b border-white/10 dark:border-white/5 hover:bg-emerald-500/10 dark:hover:bg-emerald-500/10 transition duration-200 text-slate-900 dark:text-slate-100"
          [ngClass]="{ 'bg-emerald-100/50 dark:bg-emerald-500/20': ride.id === highlightRideId }"
        >
          <td class="px-4 py-3">{{ i + 1 }}</td>
          <td class="px-4 py-3">{{ ride.departureLocation }}</td>
          <td class="px-4 py-3">{{ ride.destination }}</td>
          <td class="px-4 py-3">{{ ride.departureDate }} {{ ride.departureTime }}</td>
          <td class="px-4 py-3">{{ ride.availablePlaces }}</td>
          <td class="px-4 py-3">{{ ride.pricePerSeat }} TND</td>

          <!-- Status Badge -->
          <td class="px-4 py-3">
              <span
                class="px-2 py-1 rounded-full text-xs font-semibold"
                [ngClass]="{
                  'bg-emerald-200 dark:bg-emerald-500/30 text-emerald-800 dark:text-emerald-300': ride.status === 'over',
                  'bg-red-200 dark:bg-red-500/30 text-red-800 dark:text-red-300': ride.status === 'canceled',
                  'bg-yellow-200 dark:bg-yellow-500/30 text-yellow-800 dark:text-yellow-300': ride.status === 'in-progress'
                }"
              >
                {{ ride.status || 'in-progress' }}
              </span>
          </td>

          <td class="px-4 py-3">{{ ride.comments }}</td>

          <!-- Actions -->
          <td class="px-4 py-3">
            <!-- Already reserved -->
            <a
              *ngIf="userReservations.includes(ride.id)"
              [routerLink]="['/reservations/manage']"
              [queryParams]="{ rideId: ride.id }"
              class="inline-block px-3 py-1 bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 text-white rounded-lg text-xs font-semibold transition"
            >
              Manage
            </a>

            <!-- Reserve -->
            <div *ngIf="!userReservations.includes(ride.id)">
              <div *ngIf="ride.status === 'in-progress'" class="flex gap-2">

                <select #places class="border-2 border-slate-200 dark:border-white/20 bg-white/50 dark:bg-white/5 text-slate-900 dark:text-slate-100 rounded px-2 py-1 text-sm focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-400 transition">
                  <option
                    *ngFor="let _ of [].constructor(ride.availablePlaces); let idx = index"
                    [value]="idx + 1"
                  >
                    {{ idx + 1 }}
                  </option>
                </select>

                <button
                  class="px-3 py-1 bg-emerald-600 hover:bg-emerald-700 dark:bg-emerald-700 dark:hover:bg-emerald-600 text-white rounded-lg text-xs font-semibold transition"
                  (click)="reserve(ride, +places.value)"
                >
                  Reserve
                </button>

              </div>
            </div>
          </td>

          <!-- Details -->
          <td class="px-4 py-3">
            <button
              (click)="openRideDetails(ride)"
              class="inline-block px-3 py-1 bg-emerald-600 hover:bg-emerald-700 dark:bg-emerald-700 dark:hover:bg-emerald-600 text-white rounded-lg text-xs font-semibold transition"
            >
              View
            </button>
          </td>

        </tr>
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 bg-white/50 dark:bg-white/5 border-t border-white/20 dark:border-white/10 text-center text-sm text-slate-600 dark:text-slate-400">
      Explore and reserve rides effortlessly ðŸš—âœ¨
    </div>

  </div>
</div>
