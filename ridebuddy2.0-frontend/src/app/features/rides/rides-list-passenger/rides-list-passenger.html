<div class="max-w-7xl mx-auto my-4 bg-white rounded-lg shadow p-4">
  <div class="filter-ui mb-3 p-3 border rounded">

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block mb-1">Choose Column:</label>
        <select [(ngModel)]="filterColumn" class="w-full border rounded px-2 py-1 text-sm"
                (change)="filterValue = ''">
          <option value="">-- Select Column --</option>
          <option value="departureLocation">Departure Location</option>
          <option value="destination">Destination</option>
          <option value="departureTime">Departure Time</option>
          <option value="availablePlaces">Available Places</option>
          <option value="pricePerSeat">Price</option>
          <option value="status">Status</option>
          <option value="conductorName">Conductor</option>
        </select>
      </div>

      <div>
        <label class="block mb-1">Choose Value:</label>
        <select [(ngModel)]="filterValue" class="w-full border rounded px-2 py-1 text-sm">
          <option value="">-- Select Value --</option>
          <option *ngFor="let v of getDistinctValuesForColumn(filterColumn)" [value]="v">
            {{ v }}
          </option>
        </select>
      </div>

      <div class="flex items-end gap-2">
        <button class="px-3 py-1 rounded bg-primary text-white text-sm" (click)="applyFilter()">Apply</button>
        <button class="px-3 py-1 rounded bg-secondary text-white text-sm" (click)="resetFilter()">Reset</button>
      </div>
    </div>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">#</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Departure</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Destination</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Departure Time</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Available</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Price</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Status</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Conductor</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Comments</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Actions</th>
          <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Details</th>
        </tr>
      </thead>

      <tbody>
      <tr *ngFor="let ride of rides$ | async; let i = index"
          [ngClass]="{ 'bg-yellow-50': ride.id === highlightRideId, 'odd:bg-white even:bg-gray-50': true }">

        <td class="px-4 py-2 text-sm">{{ i + 1 }}</td>
        <td class="px-4 py-2 text-sm">{{ ride.departureLocation }}</td>
        <td class="px-4 py-2 text-sm">{{ ride.destination }}</td>
        <td class="px-4 py-2 text-sm">{{ ride.departureDate }} {{ ride.departureTime }}</td>
        <td class="px-4 py-2 text-sm">{{ ride.availablePlaces }}</td>
        <td class="px-4 py-2 text-sm">{{ ride.pricePerSeat }} TND</td>
        <td class="px-4 py-2 text-sm">{{ ride.status }}</td>
        <td class="px-4 py-2 text-sm">{{ ride.conductorName }}</td>
        <td class="px-4 py-2 text-sm">{{ ride.comments }}</td>

        <td class="px-4 py-2 text-sm">

          <!-- Already reserved -->
          <a *ngIf="userReservations.includes(ride.id)"
             [routerLink]="['/reservations/manage']"
             [queryParams]="{ rideId: ride.id }"
             class="inline-block px-2 py-1 bg-warning text-black rounded text-sm whitespace-nowrap">
            Manage Reservation
          </a>

          <!-- Not reserved -->
          <div *ngIf="!userReservations.includes(ride.id)">
            <div *ngIf="ride.status === 'in-progress'" class="flex gap-1">
              <select #places class="border rounded text-sm px-2 py-1 w-auto">
                <option *ngFor="let _ of [].constructor(ride.availablePlaces); let idx = index"
                        [value]="idx + 1">
                  {{ idx + 1 }}
                </option>
              </select>
              <button class="px-2 py-1 rounded bg-success text-white text-sm"
                      (click)="reserve(ride, +places.value)">
                Submit
              </button>
            </div>
          </div>
        </td>

        <td class="px-4 py-2 text-sm">
          <a [routerLink]="['/dashboard/rides/details', ride.id]" class="inline-block px-2 py-1 bg-secondary text-white rounded text-sm">Details</a>
        </td>

      </tr>
      </tbody>
    </table>
  </div>
</div>
