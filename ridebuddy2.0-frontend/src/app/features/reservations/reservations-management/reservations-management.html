<div class="max-w-7xl mx-5 my-7">
  <!-- Card -->
  <div class="u-card-glass">

    <!-- Header -->
    <div class="bg-linear-to-r from-emerald-500/30 to-cyan-500/30 dark:from-emerald-500/20 dark:to-cyan-500/20 p-6 rounded-2xl mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-slate-100">My Reservations</h2>
      <p class="text-slate-600 dark:text-slate-400 text-sm">Manage, filter, and track all your reservations</p>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
        <tr class="bg-white/50 dark:bg-white/5 border-b border-white/20 dark:border-white/10">
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Destination</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure Time</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Passenger</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Seats</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Status</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Actions</th>
        </tr>
        </thead>

        <tbody>
          @for (res of reservations$ | async; track res.id) {
            <tr class="border-b border-white/10 dark:border-white/5 hover:bg-white/50 dark:hover:bg-white/5 transition text-slate-900 dark:text-slate-100">

              <td class="px-4 py-3 text-sm">
                @if (res.ride) { {{ res.ride.departureLocation }} }
              </td>

              <td class="px-4 py-3 text-sm">
                @if (res.ride) { {{ res.ride.destination }} }
              </td>

              <td class="px-4 py-3 text-sm">
                @if (res.ride) { {{ res.ride.departureDate + ' ' + res.ride.departureTime }} }
              </td>

              <td class="px-4 py-3 text-sm">
                {{ res.user?.displayName || res.user?.email }}
              </td>

              <td class="px-4 py-3 text-sm">
                {{ res.reservedPlaces }}
              </td>

              <td class="px-4 py-3 text-sm">
                <span
                  class="px-3 py-1 rounded-full text-xs font-semibold"
                  [ngClass]="{
                    'bg-yellow-200 dark:bg-yellow-500/30 text-yellow-800 dark:text-yellow-300': res.status === 'PENDING',
                    'bg-emerald-200 dark:bg-emerald-500/30 text-emerald-800 dark:text-emerald-300': res.status === 'ACCEPTED',
                    'bg-red-200 dark:bg-red-500/30 text-red-800 dark:text-red-300': res.status === 'REJECTED'
                  }"
                >
                  {{ res.status }}
                </span>
              </td>

              <td class="px-4 py-3 text-sm space-x-2">
                @if (res.ride?.status === 'in-progress' && res.status === 'PENDING') {

                  <button
                    class="px-3 py-1 bg-emerald-600 hover:bg-emerald-700 dark:bg-emerald-700 dark:hover:bg-emerald-600 text-white rounded-lg text-xs font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed"
                    (click)="acceptReservation(res.id!)"
                    [disabled]="res.ride?.availablePlaces <= 0"
                    [title]="res.ride?.availablePlaces <= 0 ? 'No available seats' : 'Accept this reservation'"
                  >
                    Accept
                  </button>

                  <button
                    class="px-3 py-1 bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-600 text-white rounded-lg text-xs font-semibold transition"
                    (click)="rejectReservation(res.id!)"
                  >
                    Reject
                  </button>

                }
              </td>

            </tr>
          }

          @empty {
            <tr>
              <td colspan="7" class="px-4 py-6 text-center text-gray-500">
                No reservations found
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 border-t text-center text-sm">
      Manage your reservations easily with RideBuddy ğŸš—âœ¨
    </div>

  </div>
</div>
