<div class="max-w-7xl mx-auto my-4 bg-white rounded-lg shadow p-4">

  <h2 class="text-center mb-4">My Reservations History</h2>

  <!-- FILTER UI -->
  <div class="filter-ui mb-3">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
      <div>
        <select [(ngModel)]="filterColumn" class="w-full border rounded px-2 py-1 text-sm">
          <option value="">-- Choose Column --</option>
          <option value="departureLocation">Departure Location</option>
          <option value="destination">Destination</option>
          <option value="departureTime">Departure Time</option>
          <option value="rideStatus">Ride Status</option>
          <option value="status">Reservation Status</option>
        </select>
      </div>

      <div>
        <input [(ngModel)]="filterValue" type="text" class="w-full border rounded px-2 py-1 text-sm" placeholder="Filter value" />
      </div>

      <div>
        <button class="px-3 py-1 rounded bg-primary text-white text-sm" (click)="0">Apply</button>
      </div>

      <div>
        <button class="px-3 py-1 rounded bg-secondary text-white text-sm" (click)="resetFilter()">Reset</button>
      </div>
    </div>
  </div>

  <!-- Reservations Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200">
      <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">#</th>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Departure Location</th>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Destination</th>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Departure Time</th>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Ride Status</th>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Update</th>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Delete</th>
        <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Reservation Status</th>
      </tr>
      </thead>

      <tbody>
      <ng-container *ngIf="reservations$ | async as reservations">
        <tr *ngFor="let res of applyFilter(reservations); let i = index" class="odd:bg-white even:bg-gray-50">

          <td class="px-4 py-2 text-sm">{{ i + 1 }}</td>

          <td class="px-4 py-2 text-sm">{{ res.ride.departureLocation }}</td>
          <td class="px-4 py-2 text-sm">{{ res.ride.destination }}</td>

          <td class="px-4 py-2 text-sm">{{ res.ride.departureDate }} {{ res.ride.departureTime }}</td>

          <td class="px-4 py-2 text-sm">{{ res.ride.status }}</td>

          <td class="px-4 py-2 text-sm">
            <div
              *ngIf="res.status === 'PENDING' && res.ride.status === 'in-progress'"
              class="flex items-center gap-2"
            >
              <select #places class="border rounded text-sm px-2 py-1 w-auto">
                <option *ngFor="let _ of [].constructor(res.maxPlaces); let idx = index" [value]="idx + 1">
                  {{ idx + 1 }}
                </option>
              </select>

              <button class="px-2 py-1 rounded bg-warning text-black text-sm"
                      (click)="updateReservation(res, +places.value)">
                Update
              </button>
            </div>

            <span *ngIf="res.status !== 'PENDING'">
              {{ res.reservedPlaces }}
            </span>
          </td>

          <td class="px-4 py-2 text-sm">
            <button *ngIf="res.status === 'PENDING'" class="px-2 py-1 rounded bg-danger text-white text-sm"
                    (click)="cancelReservation(res)">
              Cancel
            </button>
          </td>

          <td class="px-4 py-2 text-sm">{{ res.status }}</td>

        </tr>
      </ng-container>
      </tbody>
    </table>
  </div>
</div>
