<div class="max-w-7xl mx-5 my-7">
  <!-- Card -->
  <div class="u-card-glass">

    <!-- Header -->
    <div class="bg-gradient-to-r from-emerald-500/30 to-cyan-500/30 dark:from-emerald-500/20 dark:to-cyan-500/20 p-6 rounded-2xl mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-slate-100">My Reservations History</h2>
      <p class="text-slate-600 dark:text-slate-400 text-sm">Track, update, and manage all your past reservations</p>
    </div>

    <!-- Filter Section -->
    <div class="p-6 border-b border-white/20 dark:border-white/10">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

        <!-- Column Selection -->
        <select
          [(ngModel)]="filterColumn"
          class="px-4 py-2 bg-white/50 dark:bg-white/5 border-2 border-slate-200 dark:border-white/20 rounded-lg text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:focus:ring-emerald-500/30 transition">
          <option value="">-- Choose Column --</option>
          <option value="departureLocation">Departure Location</option>
          <option value="destination">Destination</option>
          <option value="departureTime">Departure Time</option>
          <option value="rideStatus">Ride Status</option>
          <option value="status">Reservation Status</option>
        </select>

        <!-- Value Input -->
        <input
          [(ngModel)]="filterValue"
          type="text"
          placeholder="Filter value..."
          class="px-4 py-2 bg-white/50 dark:bg-white/5 border-2 border-slate-200 dark:border-white/20 rounded-lg text-sm text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:focus:ring-emerald-500/30 transition"
        />

        <!-- Apply -->
        <button
          class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-cyan-600 hover:from-emerald-600 hover:to-cyan-700 text-white rounded-lg text-sm font-semibold hover:shadow-lg hover:shadow-emerald-500/30 transition"
          (click)="0"
        >
          Apply
        </button>

        <!-- Reset -->
        <button
          class="px-4 py-2 bg-slate-600 dark:bg-slate-700 hover:bg-slate-700 dark:hover:bg-slate-600 text-white rounded-lg text-sm font-semibold transition"
          (click)="resetFilter()"
        >
          Reset
        </button>

      </div>
    </div>

    <!-- Table Section -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
        <tr class="bg-white/50 dark:bg-white/5 border-b border-white/20 dark:border-white/10">
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">#</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Destination</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Departure Time</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Ride Status</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Update</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Delete</th>
          <th class="px-4 py-3 text-left font-semibold text-slate-900 dark:text-slate-100">Reservation Status</th>
        </tr>
        </thead>

        <tbody>
        <ng-container *ngIf="reservations$ | async as reservations">

          <tr
            *ngFor="let res of applyFilter(reservations); let i = index"
            class="border-b border-white/10 dark:border-white/5 hover:bg-white/50 dark:hover:bg-white/5 transition text-slate-900 dark:text-slate-100"
          >
            <td class="px-4 py-3">{{ i + 1 }}</td>

            <td class="px-4 py-3">{{ res.ride.departureLocation }}</td>
            <td class="px-4 py-3">{{ res.ride.destination }}</td>

            <td class="px-4 py-3">
              {{ res.ride.departureDate }} {{ res.ride.departureTime }}
            </td>

            <!-- Ride Status Badge -->
            <td class="px-4 py-3">
              <span
                class="px-2 py-1 rounded-full text-xs font-semibold"
                [ngClass]="{
                  'bg-emerald-200 dark:bg-emerald-500/30 text-emerald-800 dark:text-emerald-300': res.ride.status === 'over',
                  'bg-red-200 dark:bg-red-500/30 text-red-800 dark:text-red-300': res.ride.status === 'canceled',
                  'bg-yellow-200 dark:bg-yellow-500/30 text-yellow-800 dark:text-yellow-300': res.ride.status === 'in-progress'
                }"
              >
                {{ res.ride.status }}
              </span>
            </td>

            <!-- Update reservation -->
            <td class="px-4 py-3">
              <div *ngIf="res.status === 'PENDING' && res.ride.status === 'in-progress'"
                   class="flex items-center gap-2">

                <select #places class="border rounded-lg px-2 py-1 text-sm">
                  <option *ngFor="let _ of [].constructor(res.maxPlaces); let idx = index" [value]="idx + 1">
                    {{ idx + 1 }}
                  </option>
                </select>

                <button
                  class="px-3 py-1 bg-yellow-400 text-black rounded-lg text-xs font-semibold hover:bg-yellow-500 transition"
                  (click)="updateReservation(res, +places.value)"
                >
                  Update
                </button>
              </div>

              <span *ngIf="res.status !== 'PENDING'">
                {{ res.reservedPlaces }}
              </span>
            </td>

            <!-- Cancel -->
            <td class="px-4 py-3">
              <button
                *ngIf="res.status === 'PENDING'"
                class="px-3 py-1 bg-red-600 text-white rounded-lg text-xs font-semibold
                       hover:bg-red-700 transition"
                (click)="cancelReservation(res)"
              >
                Cancel
              </button>
            </td>

            <!-- Reservation Status Badge -->
            <td class="px-4 py-3">
              <span
                class="px-2 py-1 rounded-full text-xs font-semibold"
                [ngClass]="{
                  'bg-blue-200 text-blue-800': res.status === 'PENDING',
                  'bg-green-200 text-green-800': res.status === 'CONFIRMED',
                  'bg-gray-300 text-gray-700': res.status === 'CANCELED'
                }"
              >
                {{ res.status }}
              </span>
            </td>

          </tr>

        </ng-container>
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 bg-gray-50 border-t text-center text-sm text-gray-600">
      View and manage all your past reservations ğŸš—ğŸ“
    </div>

  </div>
</div>
