<div class="container py-4 mt-3">

  <h2 class="text-center mb-4">My Reservations History</h2>

  <!-- FILTER UI -->
  <div class="filter-ui mb-3">
    <div class="row g-2">
      <div class="col-auto">
        <select [(ngModel)]="filterColumn" class="form-select">
          <option value="">-- Choose Column --</option>
          <option value="departureLocation">Departure Location</option>
          <option value="destination">Destination</option>
          <option value="departureTime">Departure Time</option>
          <option value="rideStatus">Ride Status</option>
          <option value="status">Reservation Status</option>
        </select>
      </div>

      <div class="col-auto">
        <input [(ngModel)]="filterValue" type="text" class="form-control" placeholder="Filter value" />
      </div>

      <div class="col-auto">
        <button class="btn btn-primary" (click)="0">Apply</button>
      </div>

      <div class="col-auto">
        <button class="btn btn-secondary" (click)="resetFilter()">Reset</button>
      </div>
    </div>
  </div>

  <!-- Reservations Table -->
  <table class="table table-striped">
    <thead>
    <tr>
      <th>#</th>
      <th>Departure Location</th>
      <th>Destination</th>
      <th>Departure Time</th>
      <th>Ride Status</th>
      <th>Update</th>
      <th>Delete</th>
      <th>Reservation Status</th>
    </tr>
    </thead>

    <tbody>
    <ng-container *ngIf="reservations$ | async as reservations">
      <tr *ngFor="let res of applyFilter(reservations); let i = index">

        <td>{{ i + 1 }}</td>

        <td>{{ res.ride.departureLocation }}</td>
        <td>{{ res.ride.destination }}</td>

        <td>{{ res.ride.departureDate }} {{ res.ride.departureTime }}</td>

        <td>{{ res.ride.status }}</td>

        <td>
          <div
            *ngIf="res.status === 'PENDING' && res.ride.status === 'in-progress'"
            class="d-flex align-items-center gap-2"
          >
            <select #places class="form-select form-select-sm w-auto d-inline-block">
              <option *ngFor="let _ of [].constructor(res.maxPlaces); let idx = index" [value]="idx + 1">
                {{ idx + 1 }}
              </option>
            </select>

            <button class="btn btn-warning btn-sm"
                    (click)="updateReservation(res, +places.value)">
              Update
            </button>
          </div>

          <span *ngIf="res.status !== 'PENDING'">
            {{ res.reservedPlaces }}
          </span>
        </td>

        <td>
          <button *ngIf="res.status === 'PENDING'" class="btn btn-danger btn-sm"
                  (click)="cancelReservation(res)">
            Cancel
          </button>
        </td>

        <td>{{ res.status }}</td>

      </tr>
    </ng-container>
    </tbody>
  </table>
</div>
